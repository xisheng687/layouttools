<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WePub - å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…· | ä¸“ä¸šæ–‡ç« æ’ç‰ˆç¥å™¨</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="WePub æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·ï¼Œæ”¯æŒ Markdown è½¬æ¢ã€10 å¥—é«˜åŒºåˆ†åº¦é…è‰²æ–¹æ¡ˆã€å®æ—¶é¢„è§ˆç¼–è¾‘ã€‚ä¸€é”®å¤åˆ¶ï¼Œè®©ä½ çš„å…¬ä¼—å·æ–‡ç« æ›´ä¸“ä¸šã€æ›´ç¾è§‚ã€‚">
  <meta name="keywords" content="å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆ,Markdownè½¬æ¢,å…¬ä¼—å·ç¼–è¾‘å™¨,æ–‡ç« æ’ç‰ˆå·¥å…·,WeChatæ’ç‰ˆ,WePub">
  <meta name="author" content="WePub">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://wepub.app/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://wepub.app/">
  <meta property="og:title" content="WePub - å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·">
  <meta property="og:description" content="ä¸“ä¸šçš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·ï¼Œæ”¯æŒ Markdown è½¬æ¢ã€ç²¾é€‰é…è‰²æ–¹æ¡ˆã€å®æ—¶é¢„è§ˆã€‚è®©ä½ çš„å…¬ä¼—å·æ–‡ç« æ›´ä¸“ä¸šã€‚">
  <meta property="og:image" content="https://wepub.app/og-image.png">
  <meta property="og:locale" content="zh_CN">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="WePub - å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·">
  <meta name="twitter:description" content="ä¸“ä¸šçš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·ï¼Œæ”¯æŒ Markdown è½¬æ¢ã€ç²¾é€‰é…è‰²æ–¹æ¡ˆã€å®æ—¶é¢„è§ˆã€‚">
  <meta name="twitter:image" content="https://wepub.app/og-image.png">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%236366f1'/%3E%3Cstop offset='100%25' style='stop-color:%23a855f7'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='8' fill='url(%23g)'/%3E%3Cpath d='M8 10h16M8 16h12M8 22h14' stroke='white' stroke-width='2.5' stroke-linecap='round'/%3E%3C/svg%3E">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "WePub",
    "description": "ä¸“ä¸šçš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·ï¼Œæ”¯æŒ Markdown è½¬æ¢ã€ç²¾é€‰é…è‰²æ–¹æ¡ˆã€å®æ—¶é¢„è§ˆç¼–è¾‘",
    "url": "https://wepub.app",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CNY"
    },
    "featureList": [
      "Markdown è½¬ HTML",
      "10 å¥—é«˜åŒºåˆ†åº¦é…è‰²æ–¹æ¡ˆ",
      "å®æ—¶é¢„è§ˆç¼–è¾‘",
      "ä¸€é”®å¤åˆ¶åˆ°å¾®ä¿¡",
      "è‡ªå®šä¹‰å­—ç¬¦æ›¿æ¢"
    ]
  }
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --accent: #a855f7;
      --bg-dark: #0f0f14;
      --bg-sidebar: #18181f;
      --bg-card: #1f1f28;
      --bg-hover: #2a2a35;
      --bg-main: #fafbfc;
      --text-primary: #f4f4f5;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --border-color: #27272a;
      --gradient-primary: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      --gradient-glow: linear-gradient(135deg, rgba(99,102,241,0.15) 0%, rgba(168,85,247,0.15) 100%);
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.2);
      --shadow-glow: 0 0 40px rgba(99,102,241,0.15);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-main);
      height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    /* å·¦ä¾§è®¾ç½®é¢æ¿ - Apple é£æ ¼æ·±è‰² */
    .sidebar {
      width: 320px;
      background: var(--bg-sidebar);
      color: var(--text-primary);
      overflow-y: auto;
      transition: var(--transition);
      flex-shrink: 0;
      border-right: 1px solid var(--border-color);
    }

    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: var(--text-muted);
      border-radius: 3px;
    }

    .sidebar.collapsed {
      width: 56px;
    }

    .sidebar.collapsed .sidebar-content {
      display: none;
    }

    .sidebar-header {
      padding: 20px;
      background: var(--bg-dark);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-glow);
    }

    .sidebar-logo svg {
      width: 22px;
      height: 22px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.02em;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .sidebar.collapsed .sidebar-brand .sidebar-title {
      display: none;
    }

    .sidebar-toggle {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-toggle:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .sidebar-content {
      padding: 20px;
    }

    /* ç»Ÿè®¡é¢æ¿ */
    .stats-panel {
      background: var(--gradient-glow);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* å¯æŠ˜å è®¾ç½®ç»„ */
    .setting-group {
      margin-bottom: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      overflow: hidden;
      transition: var(--transition);
    }

    .setting-group:hover {
      border-color: #3f3f46;
    }

    .setting-group-header {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
    }

    .setting-group-header:hover {
      background: var(--bg-hover);
    }

    .setting-group-title {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .setting-group-toggle {
      color: var(--text-muted);
      font-size: 10px;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .setting-group.collapsed .setting-group-toggle {
      transform: rotate(-90deg);
    }

    .setting-group-content {
      padding: 0 16px 16px;
      display: block;
    }

    .setting-group.collapsed .setting-group-content {
      display: none;
    }

    .setting-item {
      margin-bottom: 14px;
    }

    .setting-item:last-child {
      margin-bottom: 0;
    }

    .setting-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: block;
      font-weight: 500;
    }

    .setting-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-input {
      width: 40px;
      height: 32px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-sm);
      cursor: pointer;
      padding: 2px;
      background: transparent;
      transition: var(--transition);
    }

    .color-input:hover {
      border-color: var(--primary);
    }

    .text-input {
      flex: 1;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-family: inherit;
      transition: var(--transition);
    }

    .text-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
    }

    .text-input.small {
      width: 70px;
      flex: none;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
    }

    .checkbox-label:hover {
      color: var(--text-primary);
    }

    .checkbox-label input {
      width: 16px;
      height: 16px;
      accent-color: var(--primary);
    }

    /* åˆ—è¡¨æ ·å¼é€‰é¡¹ */
    .list-style-options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .radio-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 6px 10px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .radio-label:hover {
      border-color: var(--primary);
      color: var(--text-primary);
    }

    .radio-label:has(input:checked) {
      border-color: var(--primary);
      background: rgba(99,102,241,0.15);
      color: var(--text-primary);
    }

    .radio-label input {
      display: none;
    }

    /* æ›¿æ¢è§„åˆ™ */
    .replace-list {
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      overflow: hidden;
      margin-bottom: 10px;
    }

    .replace-item {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
      gap: 8px;
      font-size: 13px;
    }

    .replace-item:last-child {
      border-bottom: none;
    }

    .replace-from, .replace-to {
      background: var(--bg-hover);
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 12px;
    }

    .replace-arrow {
      color: var(--text-muted);
    }

    .replace-delete {
      margin-left: auto;
      background: none;
      border: none;
      color: #ef4444;
      cursor: pointer;
      padding: 4px 6px;
      font-size: 11px;
      border-radius: 4px;
      transition: var(--transition);
    }

    .replace-delete:hover {
      background: rgba(239,68,68,0.15);
    }

    .add-replace-btn {
      background: transparent;
      border: 1px dashed var(--border-color);
      color: var(--text-muted);
      padding: 10px;
      text-align: center;
      cursor: pointer;
      font-size: 12px;
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .add-replace-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--primary);
    }

    /* é…è‰²æ–¹æ¡ˆé¢„è®¾ */
    .preset-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 14px;
    }

    .preset-item {
      background: var(--bg-dark);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-sm);
      padding: 10px 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .preset-item:hover {
      background: var(--bg-hover);
      border-color: #3f3f46;
      transform: translateY(-1px);
    }

    .preset-item.active {
      border-color: var(--primary);
      background: rgba(99,102,241,0.1);
      box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
    }

    .preset-name {
      font-size: 11px;
      color: var(--text-primary);
      margin-bottom: 8px;
      text-align: center;
      font-weight: 500;
    }

    .preset-colors {
      display: flex;
      justify-content: center;
      gap: 4px;
    }

    .preset-color-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.1);
      transition: var(--transition);
    }

    .preset-item:hover .preset-color-dot {
      transform: scale(1.1);
    }

    .current-preset {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      padding: 8px;
      background: var(--bg-dark);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
    }

    .reset-btn {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      width: 100%;
      font-size: 13px;
      font-weight: 500;
      margin-top: 20px;
      transition: var(--transition);
    }

    .reset-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: #3f3f46;
    }

    .guide-link {
      display: block;
      text-align: center;
      padding: 12px;
      margin-top: 12px;
      color: var(--primary);
      font-size: 13px;
      text-decoration: none;
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .guide-link:hover {
      background: rgba(99,102,241,0.1);
    }

    /* ä¸»å†…å®¹åŒº */
    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
    }

    .header {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 16px 24px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .header-logo {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md), var(--shadow-glow);
    }

    .header-logo svg {
      width: 24px;
      height: 24px;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 700;
      color: #18181b;
      letter-spacing: -0.02em;
    }

    .header-tagline {
      font-size: 13px;
      color: #71717a;
      margin-top: 2px;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 18px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: var(--transition);
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: var(--shadow-sm), 0 0 20px rgba(99,102,241,0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md), 0 0 30px rgba(99,102,241,0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-success:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md), 0 0 20px rgba(16,185,129,0.3);
    }

    .btn-secondary {
      background: white;
      color: #3f3f46;
      border: 1px solid #e4e4e7;
      box-shadow: var(--shadow-sm);
    }

    .btn-secondary:hover {
      background: #fafafa;
      border-color: #d4d4d8;
    }

    .content-area {
      flex: 1;
      display: flex;
      overflow: hidden;
      padding: 20px;
      gap: 20px;
    }

    .input-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }

    .section-header {
      padding: 14px 20px;
      background: #fafafa;
      border-bottom: 1px solid #f4f4f5;
      font-size: 13px;
      color: #52525b;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .drop-zone {
      padding: 32px 20px;
      text-align: center;
      border-bottom: 1px solid #f4f4f5;
      background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%);
      transition: var(--transition);
    }

    .drop-zone.dragover {
      background: linear-gradient(180deg, rgba(99,102,241,0.05) 0%, rgba(168,85,247,0.05) 100%);
      border-color: var(--primary);
    }

    .drop-icon {
      font-size: 40px;
      margin-bottom: 12px;
      opacity: 0.8;
    }

    .drop-text {
      color: #71717a;
      font-size: 14px;
    }

    .drop-text strong {
      color: var(--primary);
      cursor: pointer;
      font-weight: 600;
    }

    .drop-text strong:hover {
      text-decoration: underline;
    }

    .input-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #markdown-input {
      flex: 1;
      border: none;
      padding: 20px;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 14px;
      line-height: 1.7;
      resize: none;
      background: white;
      color: #18181b;
    }

    #markdown-input:focus {
      outline: none;
    }

    #markdown-input::placeholder {
      color: #a1a1aa;
    }

    /* é¢„è§ˆåŒº */
    .preview-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }

    .preview-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: white;
      min-height: 200px;
    }

    .preview-content::-webkit-scrollbar {
      width: 8px;
    }

    .preview-content::-webkit-scrollbar-track {
      background: #f4f4f5;
    }

    .preview-content::-webkit-scrollbar-thumb {
      background: #d4d4d8;
      border-radius: 4px;
    }

    .preview-content:empty::before {
      content: 'é¢„è§ˆåŒºåŸŸï¼ˆå¯ç›´æ¥ç¼–è¾‘ï¼‰\Aè¾“å…¥æˆ–æ‹–å…¥ Markdown æ–‡ä»¶åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºè½¬æ¢åçš„æ•ˆæœ';
      white-space: pre-wrap;
      color: #a1a1aa;
      font-size: 14px;
      display: block;
      text-align: center;
      padding-top: 60px;
    }

    .preview-content:focus {
      outline: none;
      box-shadow: inset 0 0 0 2px var(--primary);
    }

    .edit-indicator {
      font-size: 11px;
      color: #f59e0b;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: 4px 10px;
      border-radius: 20px;
      display: none;
      font-weight: 500;
    }

    .edit-indicator.show {
      display: inline-block;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--bg-dark);
      color: white;
      padding: 14px 24px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    #file-input {
      display: none;
    }

    /* å°æŒ‰é’®æ ·å¼ */
    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* é¡µè„šç‰ˆæƒ */
    .footer-credit {
      text-align: center;
      padding: 12px;
      font-size: 11px;
      color: var(--text-muted);
      border-top: 1px solid var(--border-color);
      margin-top: auto;
    }

    .footer-credit a {
      color: var(--primary);
      text-decoration: none;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 1200px) {
      .content-area {
        flex-direction: column;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -320px;
        height: 100vh;
        z-index: 100;
      }

      .sidebar.open {
        left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§è®¾ç½®é¢æ¿ -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="sidebar-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
              <path d="M4 6h16M4 12h10M4 18h13"/>
            </svg>
          </div>
          <span class="sidebar-title">WePub</span>
        </div>
        <button class="sidebar-toggle" onclick="toggleSidebar()" title="æ”¶èµ·/å±•å¼€">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
      </div>

      <div class="sidebar-content">
        <!-- å­—æ•°ç»Ÿè®¡ -->
        <div class="stats-panel">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="word-count">0</div>
              <div class="stat-label">å­—æ•°</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="char-count">0</div>
              <div class="stat-label">å­—ç¬¦</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="char-no-space">0</div>
              <div class="stat-label">ä¸å«ç©ºæ ¼</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="para-count">0</div>
              <div class="stat-label">æ®µè½</div>
            </div>
          </div>
        </div>

        <!-- é…è‰²æ–¹æ¡ˆ -->
        <div class="setting-group" id="group-presets">
          <div class="setting-group-header" onclick="toggleGroup('group-presets')">
            <span class="setting-group-title"><span>ğŸ¨</span> é…è‰²æ–¹æ¡ˆ</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="preset-grid" id="preset-grid"></div>
            <div class="current-preset" id="current-preset">å½“å‰ï¼šé»˜è®¤è“</div>
          </div>
        </div>

        <!-- æ ‡é¢˜é¢œè‰²è®¾ç½® -->
        <div class="setting-group collapsed" id="group-heading-colors">
          <div class="setting-group-header" onclick="toggleGroup('group-heading-colors')">
            <span class="setting-group-title"><span>ğŸ“Œ</span> è‡ªå®šä¹‰æ ‡é¢˜è‰²</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="setting-item">
              <label class="setting-label">H1 ä¸€çº§æ ‡é¢˜</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="h1-color" value="#1d4ed8">
                <input type="text" class="text-input" id="h1-color-text" value="#1d4ed8">
              </div>
            </div>
            <div class="setting-item">
              <label class="setting-label">H2 äºŒçº§æ ‡é¢˜</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="h2-color" value="#1d4ed8">
                <input type="text" class="text-input" id="h2-color-text" value="#1d4ed8">
              </div>
            </div>
            <div class="setting-item">
              <label class="setting-label">H3 ä¸‰çº§æ ‡é¢˜</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="h3-color" value="#1d4ed8">
                <input type="text" class="text-input" id="h3-color-text" value="#1d4ed8">
              </div>
            </div>
          </div>
        </div>

        <!-- æ–‡æœ¬é¢œè‰²è®¾ç½® -->
        <div class="setting-group collapsed" id="group-text-colors">
          <div class="setting-group-header" onclick="toggleGroup('group-text-colors')">
            <span class="setting-group-title"><span>âœï¸</span> è‡ªå®šä¹‰æ–‡æœ¬è‰²</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="setting-item">
              <label class="setting-label">æ­£æ–‡é¢œè‰²</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="text-color" value="#333333">
                <input type="text" class="text-input" id="text-color-text" value="#333333">
              </div>
            </div>
            <div class="setting-item">
              <label class="setting-label">åŠ ç²—é¢œè‰²</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="bold-color" value="#60a5fa">
                <input type="text" class="text-input" id="bold-color-text" value="#60a5fa">
              </div>
            </div>
            <div class="setting-item">
              <label class="setting-label">é“¾æ¥é¢œè‰²</label>
              <div class="setting-row">
                <input type="color" class="color-input" id="link-color" value="#3b82f6">
                <input type="text" class="text-input" id="link-color-text" value="#3b82f6">
              </div>
            </div>
          </div>
        </div>

        <!-- æ’ç‰ˆè®¾ç½® -->
        <div class="setting-group" id="group-typography">
          <div class="setting-group-header" onclick="toggleGroup('group-typography')">
            <span class="setting-group-title"><span>ğŸ“</span> æ’ç‰ˆè®¾ç½®</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="setting-item">
              <label class="setting-label">æ­£æ–‡å­—å·</label>
              <input type="text" class="text-input" id="font-size" value="16px">
            </div>
            <div class="setting-item">
              <label class="setting-label">è¡Œé«˜</label>
              <input type="text" class="text-input" id="line-height" value="1.8">
            </div>
            <div class="setting-item">
              <label class="setting-label">æ®µè½é—´è·</label>
              <input type="text" class="text-input" id="para-margin" value="1.5em">
            </div>
            <div class="setting-item">
              <label class="setting-label">æ ‡é¢˜é¢å¤–ç©ºè¡Œæ•°</label>
              <div class="setting-row">
                <input type="number" class="text-input small" id="title-spacing" value="1" min="0" max="5">
                <span style="font-size:11px;color:#94a3b8;">è¡Œï¼ˆ0=ä¸æ·»åŠ ï¼‰</span>
              </div>
            </div>
          </div>
        </div>

        <!-- å­—ç¬¦æ›¿æ¢ -->
        <div class="setting-group" id="group-replace">
          <div class="setting-group-header" onclick="toggleGroup('group-replace')">
            <span class="setting-group-title"><span>ğŸ”„</span> å­—ç¬¦æ›¿æ¢</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="replace-list" id="replace-list"></div>
            <div class="add-replace-btn" onclick="addReplaceRule()">+ æ·»åŠ æ›¿æ¢è§„åˆ™</div>
          </div>
        </div>

        <!-- åˆ—è¡¨æ ·å¼ -->
        <div class="setting-group" id="group-list-style">
          <div class="setting-group-header" onclick="toggleGroup('group-list-style')">
            <span class="setting-group-title"><span>ğŸ“‹</span> åˆ—è¡¨æ ·å¼</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="setting-item">
              <label class="setting-label">æ— åºåˆ—è¡¨æ ‡è®°</label>
              <div class="list-style-options" id="ul-style-options">
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="none" checked> æ— æ ‡è®°
                </label>
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="disc"> â€¢ å®å¿ƒåœ†
                </label>
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="circle"> â—‹ ç©ºå¿ƒåœ†
                </label>
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="square"> â–  æ–¹å—
                </label>
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="dash"> â€” çŸ­æ¨ª
                </label>
                <label class="radio-label">
                  <input type="radio" name="ul-style" value="custom"> è‡ªå®šä¹‰
                </label>
              </div>
              <input type="text" class="text-input" id="ul-custom-marker" placeholder="è‡ªå®šä¹‰æ ‡è®°ç¬¦å·" value="â€¢" style="margin-top:8px;display:none;">
            </div>
            <div class="setting-item">
              <label class="setting-label">æœ‰åºåˆ—è¡¨æ ‡è®°</label>
              <div class="list-style-options" id="ol-style-options">
                <label class="radio-label">
                  <input type="radio" name="ol-style" value="none" checked> æ— æ ‡è®°
                </label>
                <label class="radio-label">
                  <input type="radio" name="ol-style" value="number"> 1. 2. 3. æ•°å­—
                </label>
                <label class="radio-label">
                  <input type="radio" name="ol-style" value="chinese"> ä¸€ã€äºŒã€ä¸‰
                </label>
                <label class="radio-label">
                  <input type="radio" name="ol-style" value="bracket"> (1) (2) (3)
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="setting-group" id="group-features">
          <div class="setting-group-header" onclick="toggleGroup('group-features')">
            <span class="setting-group-title"><span>âš™ï¸</span> å…¶ä»–è®¾ç½®</span>
            <span class="setting-group-toggle">â–¼</span>
          </div>
          <div class="setting-group-content">
            <div class="setting-item">
              <label class="checkbox-label">
                <input type="checkbox" id="remove-images" checked>
                ç§»é™¤å›¾ç‰‡è¯­æ³•
              </label>
            </div>
          </div>
        </div>

        <button class="reset-btn" onclick="resetSettings()">æ¢å¤é»˜è®¤è®¾ç½®</button>
        <a href="guide.html" class="guide-link">ğŸ“– æŸ¥çœ‹ä½¿ç”¨æŒ‡å—</a>

        <div class="footer-credit">
          Made with â¤ï¸ by <a href="#">WePub</a>
        </div>
      </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-panel">
      <header class="header">
        <div class="header-brand">
          <div class="header-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
              <path d="M4 6h16M4 12h10M4 18h13"/>
            </svg>
          </div>
          <div>
            <h1>WePub</h1>
            <p class="header-tagline">ä¸“ä¸šçš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆå·¥å…·</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="clearAll()">æ¸…ç©º</button>
          <button class="btn btn-primary" onclick="copyHTML()">ğŸ“‹ å¤åˆ¶ HTML</button>
          <button class="btn btn-success" onclick="downloadMD()">â¬‡ï¸ ä¸‹è½½ MD</button>
        </div>
      </header>

      <div class="content-area">
        <!-- è¾“å…¥åŒº -->
        <section class="input-section">
          <div class="section-header">
            <span>Markdown è¾“å…¥</span>
          </div>
          <div class="drop-zone" id="drop-zone">
            <div class="drop-icon">ğŸ“„</div>
            <div class="drop-text">
              æ‹–æ‹½ .md æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ– <strong onclick="document.getElementById('file-input').click()">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</strong>
            </div>
            <input type="file" id="file-input" accept=".md,.markdown,.txt" onchange="handleFileSelect(event)">
          </div>
          <div class="input-area">
            <textarea id="markdown-input" placeholder="åœ¨è¿™é‡Œç²˜è´´æˆ–è¾“å…¥ Markdown å†…å®¹..."></textarea>
          </div>
        </section>

        <!-- é¢„è§ˆåŒº -->
        <section class="preview-section">
          <div class="section-header">
            <span>é¢„è§ˆæ•ˆæœ <span class="edit-indicator" id="edit-indicator">å·²æ‰‹åŠ¨ç¼–è¾‘</span></span>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-secondary btn-sm" onclick="resetPreview()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
              <button class="btn btn-primary btn-sm" onclick="copyHTML()">ğŸ“‹ å¤åˆ¶å…¨æ–‡</button>
            </div>
          </div>
          <div class="preview-content" id="preview-content" contenteditable="true"></div>
        </section>
      </div>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // é…è‰²æ–¹æ¡ˆé¢„è®¾ - 10 å¥—é«˜åŒºåˆ†åº¦é…è‰²
    const COLOR_PRESETS = [
      {
        name: 'å•†åŠ¡æ·±è“',
        desc: 'ä¸“ä¸šç¨³é‡ï¼Œé€‚åˆå•†åŠ¡ã€é‡‘èã€ç§‘æŠ€ä¼ä¸šç±»æ–‡ç« ',
        h1Color: '#0A1F44', h2Color: '#1E3A5F', h3Color: '#2E5090',
        boldColor: '#0D47A1', textColor: '#1A1A2E', linkColor: '#1565C0'
      },
      {
        name: 'çƒ­æƒ…çº¢æ©™',
        desc: 'æ´»åŠ›å››å°„ï¼Œé€‚åˆè¥é”€ã€ç¾é£Ÿã€ç”Ÿæ´»ç±»æ–‡ç« ',
        h1Color: '#B71C1C', h2Color: '#D84315', h3Color: '#E65100',
        boldColor: '#C62828', textColor: '#2D1B14', linkColor: '#F4511E'
      },
      {
        name: 'è‡ªç„¶æ£®æ—',
        desc: 'æ¸…æ–°è‡ªç„¶ï¼Œé€‚åˆç¯ä¿ã€å¥åº·ã€æˆ·å¤–ã€æ•™è‚²ç±»æ–‡ç« ',
        h1Color: '#1B5E20', h2Color: '#2E7D32', h3Color: '#388E3C',
        boldColor: '#33691E', textColor: '#1C2418', linkColor: '#43A047'
      },
      {
        name: 'ä¼˜é›…ç´«ç½—å…°',
        desc: 'é«˜è´µä¼˜é›…ï¼Œé€‚åˆè‰ºæœ¯ã€æ—¶å°šã€ç¾å¦†ã€æ–‡åŒ–ç±»æ–‡ç« ',
        h1Color: '#4A148C', h2Color: '#6A1B9A', h3Color: '#7B1FA2',
        boldColor: '#5E35B1', textColor: '#1A1423', linkColor: '#8E24AA'
      },
      {
        name: 'ç§‘æŠ€é’è“',
        desc: 'æœªæ¥æ„Ÿï¼Œé€‚åˆç§‘æŠ€ã€AIã€äº’è”ç½‘ã€åˆ›æ–°ç±»æ–‡ç« ',
        h1Color: '#006064', h2Color: '#00838F', h3Color: '#0097A7',
        boldColor: '#00796B', textColor: '#0D1B1E', linkColor: '#00ACC1'
      },
      {
        name: 'ä¸­å›½çº¢',
        desc: 'ä¼ ç»Ÿä¸­å¼é£æ ¼ï¼Œçº¢é‡‘é…è‰²ï¼Œåº„é‡å…¸é›…',
        h1Color: '#C41E3A', h2Color: '#8B0000', h3Color: '#B8860B',
        boldColor: '#DAA520', textColor: '#2C1810', linkColor: '#E60012'
      },
      {
        name: 'è«å…°è¿ªç°',
        desc: 'é«˜çº§ç°è°ƒé…è‰²ï¼ŒæŸ”å’Œä¼˜é›…ï¼Œä½é¥±å’Œåº¦è‰ºæœ¯ç¾æ„Ÿ',
        h1Color: '#6B7B8C', h2Color: '#8E9AAB', h3Color: '#A4B0BE',
        boldColor: '#5D6D7E', textColor: '#4A4A4A', linkColor: '#7B8D9E'
      },
      {
        name: 'æ—¥ç³»æ¸…æ–°',
        desc: 'ç²‰è“ç²‰è‰²ç³»ï¼Œæ¸©æŸ”å¯çˆ±ï¼Œå°‘å¥³æ„Ÿæ—¥å¼å°æ¸…æ–°',
        h1Color: '#FF6B9D', h2Color: '#7EC8E3', h3Color: '#FFB6C1',
        boldColor: '#E75480', textColor: '#5A5A5A', linkColor: '#69B4FF'
      },
      {
        name: 'æš—å¤œéœ“è™¹',
        desc: 'èµ›åšæœ‹å…‹é£æ ¼ï¼Œéœ“è™¹äº®è‰²ï¼Œç§‘æŠ€æ„Ÿåè¶³',
        h1Color: '#FF00FF', h2Color: '#00FFFF', h3Color: '#FF6EC7',
        boldColor: '#39FF14', textColor: '#2D2D2D', linkColor: '#FF4081'
      },
      {
        name: 'å¤å¤å’–å•¡',
        desc: 'æ£•è‰²ç³»æ€€æ—§é…è‰²ï¼Œæ¸©æš–é†‡åšï¼Œå¤å¤è´¨æ„Ÿ',
        h1Color: '#6F4E37', h2Color: '#8B4513', h3Color: '#A0522D',
        boldColor: '#CD853F', textColor: '#3C2415', linkColor: '#D2691E'
      }
    ];

    // å½“å‰é€‰ä¸­çš„é¢„è®¾
    let currentPreset = 'å•†åŠ¡æ·±è“';

    // é…ç½®å¯¹è±¡
    let CONFIG = {
      h1Color: '#0A1F44',
      h2Color: '#1E3A5F',
      h3Color: '#2E5090',
      boldColor: '#0D47A1',
      textColor: '#1A1A2E',
      linkColor: '#1565C0',
      fontSize: '16px',
      lineHeight: '1.8',
      paragraphMargin: '1.5em',
      h1Size: '24px',
      h2Size: '20px',
      h3Size: '18px',
      titleSpacing: 1,
    };

    // æ›¿æ¢è§„åˆ™ - åŒ…å«æ‰€æœ‰ä¹‹å‰æåˆ°çš„
    let replaceRules = [
      { from: 'ã€Œ', to: '"' },
      { from: 'ã€', to: '"' },
      { from: 'ã€', to: '"' },
      { from: 'ã€', to: '"' },
      { from: '*', to: '' },
    ];

    // åŠŸèƒ½å¼€å…³
    let features = {
      removeImages: true,
      ulStyle: 'none',      // none, disc, circle, square, dash, custom
      olStyle: 'none',      // none, number, chinese, bracket
      ulCustomMarker: 'â€¢',
    };

    // æ˜¯å¦æ‰‹åŠ¨ç¼–è¾‘è¿‡é¢„è§ˆ
    let previewManuallyEdited = false;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('markdown-input').addEventListener('input', debounce(convert, 300));

      // é¢„è§ˆåŒºç¼–è¾‘ç›‘å¬
      document.getElementById('preview-content').addEventListener('input', () => {
        previewManuallyEdited = true;
        document.getElementById('edit-indicator').classList.add('show');
      });

      bindColorInputs();
      bindSettingInputs();
      setupDragDrop();
      loadSettings();
      renderReplaceRules();
      renderPresets();
    });

    // æ¸²æŸ“é…è‰²é¢„è®¾
    function renderPresets() {
      const grid = document.getElementById('preset-grid');
      grid.innerHTML = COLOR_PRESETS.map(preset => `
        <div class="preset-item ${currentPreset === preset.name ? 'active' : ''}"
             onclick="applyPreset('${preset.name}')">
          <div class="preset-name">${preset.name}</div>
          <div class="preset-colors">
            <div class="preset-color-dot" style="background:${preset.h1Color};"></div>
            <div class="preset-color-dot" style="background:${preset.h2Color};"></div>
            <div class="preset-color-dot" style="background:${preset.boldColor};"></div>
            <div class="preset-color-dot" style="background:${preset.textColor};"></div>
          </div>
        </div>
      `).join('');
      document.getElementById('current-preset').textContent = `å½“å‰ï¼š${currentPreset}`;
    }

    // åº”ç”¨é…è‰²é¢„è®¾
    function applyPreset(presetName) {
      const preset = COLOR_PRESETS.find(p => p.name === presetName);
      if (!preset) return;

      currentPreset = presetName;

      // æ›´æ–° CONFIG
      CONFIG.h1Color = preset.h1Color;
      CONFIG.h2Color = preset.h2Color;
      CONFIG.h3Color = preset.h3Color;
      CONFIG.boldColor = preset.boldColor;
      CONFIG.textColor = preset.textColor;
      CONFIG.linkColor = preset.linkColor;

      // æ›´æ–° UI
      document.getElementById('h1-color').value = preset.h1Color;
      document.getElementById('h1-color-text').value = preset.h1Color;
      document.getElementById('h2-color').value = preset.h2Color;
      document.getElementById('h2-color-text').value = preset.h2Color;
      document.getElementById('h3-color').value = preset.h3Color;
      document.getElementById('h3-color-text').value = preset.h3Color;
      document.getElementById('bold-color').value = preset.boldColor;
      document.getElementById('bold-color-text').value = preset.boldColor;
      document.getElementById('text-color').value = preset.textColor;
      document.getElementById('text-color-text').value = preset.textColor;
      document.getElementById('link-color').value = preset.linkColor;
      document.getElementById('link-color-text').value = preset.linkColor;

      renderPresets();
      convert();
      saveSettings();
      showToast(`å·²åº”ç”¨ã€Œ${presetName}ã€é…è‰²`, 'success');
    }

    function debounce(fn, delay) {
      let timer;
      return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), delay);
      };
    }

    // ç»‘å®šé¢œè‰²è¾“å…¥
    function bindColorInputs() {
      const colorPairs = [
        ['h1-color', 'h1-color-text', 'h1Color'],
        ['h2-color', 'h2-color-text', 'h2Color'],
        ['h3-color', 'h3-color-text', 'h3Color'],
        ['bold-color', 'bold-color-text', 'boldColor'],
        ['text-color', 'text-color-text', 'textColor'],
        ['link-color', 'link-color-text', 'linkColor']
      ];

      colorPairs.forEach(([colorId, textId, configKey]) => {
        const colorInput = document.getElementById(colorId);
        const textInput = document.getElementById(textId);

        colorInput.addEventListener('input', (e) => {
          textInput.value = e.target.value;
          CONFIG[configKey] = e.target.value;
          markCustomPreset();
          convert();
          saveSettings();
        });

        textInput.addEventListener('input', (e) => {
          if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
            colorInput.value = e.target.value;
            CONFIG[configKey] = e.target.value;
            markCustomPreset();
            convert();
            saveSettings();
          }
        });
      });
    }

    // æ ‡è®°ä¸ºè‡ªå®šä¹‰é…è‰²
    function markCustomPreset() {
      currentPreset = 'è‡ªå®šä¹‰';
      renderPresets();
    }

    function bindSettingInputs() {
      const settings = [
        ['font-size', 'fontSize'],
        ['line-height', 'lineHeight'],
        ['para-margin', 'paragraphMargin']
      ];

      settings.forEach(([id, key]) => {
        document.getElementById(id).addEventListener('input', (e) => {
          CONFIG[key] = e.target.value;
          convert();
          saveSettings();
        });
      });

      // æ ‡é¢˜ç©ºè¡Œæ•°
      document.getElementById('title-spacing').addEventListener('input', (e) => {
        CONFIG.titleSpacing = parseInt(e.target.value) || 0;
        convert();
        saveSettings();
      });

      // åŠŸèƒ½å¼€å…³
      document.getElementById('remove-images').addEventListener('change', (e) => {
        features.removeImages = e.target.checked;
        convert();
        saveSettings();
      });

      // æ— åºåˆ—è¡¨æ ·å¼
      document.querySelectorAll('input[name="ul-style"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          features.ulStyle = e.target.value;
          const customInput = document.getElementById('ul-custom-marker');
          customInput.style.display = e.target.value === 'custom' ? 'block' : 'none';
          convert();
          saveSettings();
        });
      });

      // æ— åºåˆ—è¡¨è‡ªå®šä¹‰æ ‡è®°
      document.getElementById('ul-custom-marker').addEventListener('input', (e) => {
        features.ulCustomMarker = e.target.value || 'â€¢';
        convert();
        saveSettings();
      });

      // æœ‰åºåˆ—è¡¨æ ·å¼
      document.querySelectorAll('input[name="ol-style"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          features.olStyle = e.target.value;
          convert();
          saveSettings();
        });
      });
    }

    // è®¾ç½®ç»„æŠ˜å 
    function toggleGroup(groupId) {
      const group = document.getElementById(groupId);
      group.classList.toggle('collapsed');
      saveSettings();
    }

    // ä¾§è¾¹æ æŠ˜å 
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    // æ‹–æ‹½è®¾ç½®
    function setupDragDrop() {
      const dropZone = document.getElementById('drop-zone');

      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
      });

      ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
      });

      dropZone.addEventListener('drop', handleDrop, false);
    }

    function handleDrop(e) {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        readFile(files[0]);
      }
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) {
        readFile(file);
      }
    }

    function readFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('markdown-input').value = e.target.result;
        convert();
        showToast('æ–‡ä»¶å·²åŠ è½½', 'success');
      };
      reader.readAsText(file);
    }

    // è½¬æ¢
    function convert() {
      const markdown = document.getElementById('markdown-input').value;
      if (!markdown.trim()) {
        document.getElementById('preview-content').innerHTML = '';
        updateStats('');
        previewManuallyEdited = false;
        document.getElementById('edit-indicator').classList.remove('show');
        return;
      }

      const html = convertMarkdownToWechat(markdown);
      document.getElementById('preview-content').innerHTML = html;
      updateStats(markdown);
      previewManuallyEdited = false;
      document.getElementById('edit-indicator').classList.remove('show');
    }

    // é‡æ–°ç”Ÿæˆé¢„è§ˆ
    function resetPreview() {
      convert();
      showToast('å·²é‡æ–°ç”Ÿæˆ', 'success');
    }

    function convertMarkdownToWechat(markdown) {
      let html = markdown;

      // 1. å¤„ç†ä»£ç å—
      const codeBlocks = [];
      html = html.replace(/```[\s\S]*?```/g, (match) => {
        codeBlocks.push(match);
        return `\x00CODEBLOCK${codeBlocks.length - 1}\x00`;
      });

      // 2. å¤„ç†è¡Œå†…ä»£ç 
      const inlineCodes = [];
      html = html.replace(/`([^`]+)`/g, (match, code) => {
        inlineCodes.push(code);
        return `\x00INLINECODE${inlineCodes.length - 1}\x00`;
      });

      // 3. å¤„ç†å›¾ç‰‡
      if (features.removeImages) {
        html = html.replace(/!\[([^\]]*)\]\([^)]+\)/g, '');
      }

      // 4. å¤„ç†æ ‡é¢˜ - ä½¿ç”¨å„è‡ªçš„é¢œè‰²
      html = html.replace(/^### (.+)$/gm, (match, title) => {
        return `<h3 style="color:${CONFIG.h3Color}; font-size:${CONFIG.h3Size}; font-weight:bold; margin:1.2em 0 0.8em 0; line-height:1.4;">${title.trim()}</h3>`;
      });

      html = html.replace(/^## (.+)$/gm, (match, title) => {
        return `<h2 style="color:${CONFIG.h2Color}; font-size:${CONFIG.h2Size}; font-weight:bold; margin:1.5em 0 0.8em 0; line-height:1.4;">${title.trim()}</h2>`;
      });

      html = html.replace(/^# (.+)$/gm, (match, title) => {
        return `<h1 style="color:${CONFIG.h1Color}; font-size:${CONFIG.h1Size}; font-weight:bold; margin:0 0 1em 0; line-height:1.4;">${title.trim()}</h1>`;
      });

      // 5. å¤„ç†åŠ ç²—+æ–œä½“
      html = html.replace(/\*\*\*(.+?)\*\*\*/g, `<strong style="color:${CONFIG.boldColor};"><em>$1</em></strong>`);
      html = html.replace(/___(.+?)___/g, `<strong style="color:${CONFIG.boldColor};"><em>$1</em></strong>`);

      // 6. å¤„ç†åŠ ç²—
      html = html.replace(/\*\*(.+?)\*\*/g, `<strong style="color:${CONFIG.boldColor};">$1</strong>`);
      html = html.replace(/__(.+?)__/g, `<strong style="color:${CONFIG.boldColor};">$1</strong>`);

      // 7. å¤„ç†æ–œä½“
      html = html.replace(/(?<!\*)\*([^*\n]+?)\*(?!\*)/g, '<em>$1</em>');
      html = html.replace(/(?<!_)_([^_\n]+?)_(?!_)/g, '<em>$1</em>');

      // 8. å¤„ç†é“¾æ¥
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g,
        `<a href="$2" style="color:${CONFIG.linkColor}; text-decoration:none;">$1</a>`);

      // 9. å¤„ç†æ— åºåˆ—è¡¨
      const ulMarkers = {
        'none': '',
        'disc': 'â€¢ ',
        'circle': 'â—‹ ',
        'square': 'â–  ',
        'dash': 'â€” ',
        'custom': features.ulCustomMarker + ' '
      };
      const ulMarker = ulMarkers[features.ulStyle] || '';

      html = html.replace(/^[-*+] (.+)$/gm, (match, item) => {
        const prefix = ulMarker ? `<span style="color:${CONFIG.boldColor};">${ulMarker}</span>` : '';
        return `<p style="color:${CONFIG.textColor}; font-size:${CONFIG.fontSize}; line-height:${CONFIG.lineHeight}; margin:0 0 0.8em 0; text-align:justify;">${prefix}${item.trim()}</p>`;
      });

      // 10. å¤„ç†æœ‰åºåˆ—è¡¨
      let olCounter = 0;
      const chineseNumbers = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å'];

      html = html.replace(/^(\d+)\. (.+)$/gm, (match, num, item) => {
        olCounter++;
        let prefix = '';

        if (features.olStyle === 'number') {
          prefix = `<span style="color:${CONFIG.boldColor};">${olCounter}. </span>`;
        } else if (features.olStyle === 'chinese') {
          const chNum = olCounter <= 10 ? chineseNumbers[olCounter - 1] : olCounter;
          prefix = `<span style="color:${CONFIG.boldColor};">${chNum}ã€</span>`;
        } else if (features.olStyle === 'bracket') {
          prefix = `<span style="color:${CONFIG.boldColor};">(${olCounter}) </span>`;
        }

        return `<p style="color:${CONFIG.textColor}; font-size:${CONFIG.fontSize}; line-height:${CONFIG.lineHeight}; margin:0 0 0.8em 0; text-align:justify;">${prefix}${item.trim()}</p>`;
      });

      // 10. å¤„ç†å¼•ç”¨
      html = html.replace(/^> (.+)$/gm, (match, quote) => {
        return `<blockquote style="border-left:4px solid ${CONFIG.h1Color}; padding-left:1em; margin:1em 0; color:#666; font-style:italic;">${quote.trim()}</blockquote>`;
      });

      // 11. å¤„ç†åˆ†å‰²çº¿
      html = html.replace(/^[-*_]{3,}$/gm,
        `<hr style="border:none; border-top:1px solid #e0e0e0; margin:2em 0;">`);

      // 12. æ¢å¤ä»£ç å—
      codeBlocks.forEach((block, i) => {
        const code = block.replace(/```(\w*)\n?([\s\S]*?)```/, (m, lang, content) => {
          return `<pre style="background:#f5f5f5; padding:1em; border-radius:4px; overflow-x:auto; font-family:Consolas,Monaco,monospace; font-size:14px; line-height:1.5; margin:1em 0;"><code>${escapeHtml(content.trim())}</code></pre>`;
        });
        html = html.replace(`\x00CODEBLOCK${i}\x00`, code);
      });

      // 13. æ¢å¤è¡Œå†…ä»£ç 
      inlineCodes.forEach((code, i) => {
        html = html.replace(`\x00INLINECODE${i}\x00`,
          `<code style="background:#f5f5f5; padding:0.2em 0.4em; border-radius:3px; font-family:Consolas,Monaco,monospace; font-size:0.9em;">${escapeHtml(code)}</code>`);
      });

      // 14. å¤„ç†æ®µè½
      const lines = html.split('\n');
      const result = [];
      let paragraph = [];

      for (const line of lines) {
        const trimmed = line.trim();

        if (!trimmed) {
          if (paragraph.length > 0) {
            result.push(wrapParagraph(paragraph.join('<br>')));
            paragraph = [];
          }
          continue;
        }

        if (trimmed.startsWith('<h') ||
            trimmed.startsWith('<p') ||
            trimmed.startsWith('<ul') ||
            trimmed.startsWith('<ol') ||
            trimmed.startsWith('<li') ||
            trimmed.startsWith('<blockquote') ||
            trimmed.startsWith('<hr') ||
            trimmed.startsWith('<pre') ||
            trimmed.startsWith('</')) {
          if (paragraph.length > 0) {
            result.push(wrapParagraph(paragraph.join('<br>')));
            paragraph = [];
          }
          result.push(trimmed);
        } else {
          paragraph.push(trimmed);
        }
      }

      if (paragraph.length > 0) {
        result.push(wrapParagraph(paragraph.join('<br>')));
      }

      let output = result.join('\n\n');

      // 15. å­—ç¬¦æ›¿æ¢
      replaceRules.forEach(rule => {
        if (rule.from) {
          output = output.split(rule.from).join(rule.to);
        }
      });

      // 16. æ ‡é¢˜é¢å¤–ç©ºè¡Œ
      if (CONFIG.titleSpacing > 0) {
        const spacing = '\n'.repeat(CONFIG.titleSpacing);
        output = output.replace(/(<h[1-3][^>]*>)/g, spacing + '$1');
        output = output.replace(/(<\/h[1-3]>)/g, '$1' + spacing);
      }

      return output;
    }

    function wrapParagraph(text) {
      if (!text.trim()) return '';
      const blockTags = ['<h1', '<h2', '<h3', '<h4', '<h5', '<h6', '<ul', '<ol', '<li', '<blockquote', '<hr', '<pre', '<div', '<table'];
      const trimmedText = text.trim();
      for (const tag of blockTags) {
        if (trimmedText.startsWith(tag)) return text;
      }
      return `<p style="color:${CONFIG.textColor}; font-size:${CONFIG.fontSize}; line-height:${CONFIG.lineHeight}; margin:0 0 ${CONFIG.paragraphMargin} 0; text-align:justify;">${text}</p>`;
    }

    function escapeHtml(text) {
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function updateStats(markdown) {
      const plainText = markdown
        .replace(/^#+\s+/gm, '')
        .replace(/\*\*(.+?)\*\*/g, '$1')
        .replace(/\*(.+?)\*/g, '$1')
        .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1')
        .replace(/[-*+] /gm, '')
        .replace(/^\d+\. /gm, '')
        .replace(/\n+/g, '\n')
        .trim();

      const charCount = plainText.length;
      const charCountNoSpace = plainText.replace(/\s/g, '').length;
      const chineseChars = (plainText.match(/[\u4e00-\u9fa5]/g) || []).length;
      const englishWords = (plainText.match(/[a-zA-Z]+/g) || []).length;
      const wordCount = chineseChars + englishWords;
      const paraCount = markdown.split(/\n\s*\n/).filter(p => p.trim()).length;

      document.getElementById('word-count').textContent = wordCount;
      document.getElementById('char-count').textContent = charCount;
      document.getElementById('char-no-space').textContent = charCountNoSpace;
      document.getElementById('para-count').textContent = paraCount;
    }

    // å¤åˆ¶ HTML - ä½¿ç”¨é¢„è§ˆåŒºå†…å®¹ï¼ˆåŒ…æ‹¬æ‰‹åŠ¨ç¼–è¾‘åçš„ï¼‰
    function copyHTML() {
      const preview = document.getElementById('preview-content');
      if (!preview.innerHTML) {
        showToast('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(preview);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);

      try {
        document.execCommand('copy');
        showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿' + (previewManuallyEdited ? 'ï¼ˆåŒ…å«æ‰‹åŠ¨ä¿®æ”¹ï¼‰' : ''), 'success');
      } catch (err) {
        showToast('å¤åˆ¶å¤±è´¥');
      }

      selection.removeAllRanges();
    }

    // ä¸‹è½½ MD
    function downloadMD() {
      const markdown = document.getElementById('markdown-input').value;
      if (!markdown) {
        showToast('æ²¡æœ‰å†…å®¹å¯ä¸‹è½½');
        return;
      }

      const blob = new Blob([markdown], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'article.md';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('ä¸‹è½½å®Œæˆ', 'success');
    }

    function clearAll() {
      document.getElementById('markdown-input').value = '';
      document.getElementById('preview-content').innerHTML = '';
      updateStats('');
      previewManuallyEdited = false;
      document.getElementById('edit-indicator').classList.remove('show');
    }

    // æ›¿æ¢è§„åˆ™ç®¡ç†
    function addReplaceRule() {
      const from = prompt('è¾“å…¥è¦æ›¿æ¢çš„å­—ç¬¦:');
      if (from === null) return;
      const to = prompt('æ›¿æ¢ä¸º (ç•™ç©ºåˆ™åˆ é™¤):') || '';

      replaceRules.push({ from, to });
      renderReplaceRules();
      convert();
      saveSettings();
    }

    function removeReplace(index) {
      replaceRules.splice(index, 1);
      renderReplaceRules();
      convert();
      saveSettings();
    }

    function renderReplaceRules() {
      const list = document.getElementById('replace-list');
      list.innerHTML = replaceRules.map((rule, index) => `
        <div class="replace-item">
          <span class="replace-from">${escapeHtml(rule.from)}</span>
          <span class="replace-arrow">â†’</span>
          <span class="replace-to">${rule.to ? escapeHtml(rule.to) : '(åˆ é™¤)'}</span>
          <button class="replace-delete" onclick="removeReplace(${index})">âœ•</button>
        </div>
      `).join('');
    }

    function resetSettings() {
      CONFIG = {
        h1Color: '#0A1F44',
        h2Color: '#1E3A5F',
        h3Color: '#2E5090',
        boldColor: '#0D47A1',
        textColor: '#1A1A2E',
        linkColor: '#1565C0',
        fontSize: '16px',
        lineHeight: '1.8',
        paragraphMargin: '1.5em',
        h1Size: '24px',
        h2Size: '20px',
        h3Size: '18px',
        titleSpacing: 1,
      };

      replaceRules = [
        { from: 'ã€Œ', to: '"' },
        { from: 'ã€', to: '"' },
        { from: 'ã€', to: '"' },
        { from: 'ã€', to: '"' },
        { from: '*', to: '' },
      ];

      features = {
        removeImages: true,
        ulStyle: 'none',
        olStyle: 'none',
        ulCustomMarker: 'â€¢',
      };

      currentPreset = 'å•†åŠ¡æ·±è“';

      // æ›´æ–° UI
      document.getElementById('h1-color').value = CONFIG.h1Color;
      document.getElementById('h1-color-text').value = CONFIG.h1Color;
      document.getElementById('h2-color').value = CONFIG.h2Color;
      document.getElementById('h2-color-text').value = CONFIG.h2Color;
      document.getElementById('h3-color').value = CONFIG.h3Color;
      document.getElementById('h3-color-text').value = CONFIG.h3Color;
      document.getElementById('bold-color').value = CONFIG.boldColor;
      document.getElementById('bold-color-text').value = CONFIG.boldColor;
      document.getElementById('text-color').value = CONFIG.textColor;
      document.getElementById('text-color-text').value = CONFIG.textColor;
      document.getElementById('link-color').value = CONFIG.linkColor;
      document.getElementById('link-color-text').value = CONFIG.linkColor;
      document.getElementById('font-size').value = CONFIG.fontSize;
      document.getElementById('line-height').value = CONFIG.lineHeight;
      document.getElementById('para-margin').value = CONFIG.paragraphMargin;
      document.getElementById('title-spacing').value = CONFIG.titleSpacing;
      document.getElementById('remove-images').checked = features.removeImages;

      // æ¢å¤åˆ—è¡¨æ ·å¼é€‰é¡¹
      document.querySelector(`input[name="ul-style"][value="${features.ulStyle}"]`).checked = true;
      document.querySelector(`input[name="ol-style"][value="${features.olStyle}"]`).checked = true;
      document.getElementById('ul-custom-marker').value = features.ulCustomMarker;
      document.getElementById('ul-custom-marker').style.display = features.ulStyle === 'custom' ? 'block' : 'none';

      // å±•å¼€æ‰€æœ‰è®¾ç½®ç»„
      document.querySelectorAll('.setting-group').forEach(g => g.classList.remove('collapsed'));

      renderReplaceRules();
      renderPresets();
      convert();
      localStorage.removeItem('wechat-format-settings');
      showToast('å·²æ¢å¤é»˜è®¤è®¾ç½®', 'success');
    }

    function saveSettings() {
      const collapsedGroups = [];
      document.querySelectorAll('.setting-group.collapsed').forEach(g => collapsedGroups.push(g.id));

      const settings = { CONFIG, replaceRules, features, collapsedGroups, currentPreset };
      localStorage.setItem('wechat-format-settings', JSON.stringify(settings));
    }

    function loadSettings() {
      const saved = localStorage.getItem('wechat-format-settings');
      if (saved) {
        try {
          const settings = JSON.parse(saved);
          CONFIG = { ...CONFIG, ...settings.CONFIG };
          replaceRules = settings.replaceRules || replaceRules;
          features = { ...features, ...settings.features };
          currentPreset = settings.currentPreset || 'å•†åŠ¡æ·±è“';

          // æ›´æ–° UI
          document.getElementById('h1-color').value = CONFIG.h1Color;
          document.getElementById('h1-color-text').value = CONFIG.h1Color;
          document.getElementById('h2-color').value = CONFIG.h2Color;
          document.getElementById('h2-color-text').value = CONFIG.h2Color;
          document.getElementById('h3-color').value = CONFIG.h3Color;
          document.getElementById('h3-color-text').value = CONFIG.h3Color;
          document.getElementById('bold-color').value = CONFIG.boldColor;
          document.getElementById('bold-color-text').value = CONFIG.boldColor;
          document.getElementById('text-color').value = CONFIG.textColor;
          document.getElementById('text-color-text').value = CONFIG.textColor;
          document.getElementById('link-color').value = CONFIG.linkColor;
          document.getElementById('link-color-text').value = CONFIG.linkColor;
          document.getElementById('font-size').value = CONFIG.fontSize;
          document.getElementById('line-height').value = CONFIG.lineHeight;
          document.getElementById('para-margin').value = CONFIG.paragraphMargin;
          document.getElementById('title-spacing').value = CONFIG.titleSpacing;
          document.getElementById('remove-images').checked = features.removeImages;

          // æ¢å¤åˆ—è¡¨æ ·å¼é€‰é¡¹
          const ulStyleRadio = document.querySelector(`input[name="ul-style"][value="${features.ulStyle}"]`);
          if (ulStyleRadio) ulStyleRadio.checked = true;
          const olStyleRadio = document.querySelector(`input[name="ol-style"][value="${features.olStyle}"]`);
          if (olStyleRadio) olStyleRadio.checked = true;
          document.getElementById('ul-custom-marker').value = features.ulCustomMarker || 'â€¢';
          document.getElementById('ul-custom-marker').style.display = features.ulStyle === 'custom' ? 'block' : 'none';

          // æ¢å¤æŠ˜å çŠ¶æ€
          if (settings.collapsedGroups) {
            settings.collapsedGroups.forEach(id => {
              const group = document.getElementById(id);
              if (group) group.classList.add('collapsed');
            });
          }

          renderReplaceRules();
        } catch (e) {
          console.error('Failed to load settings:', e);
        }
      }
    }

    function showToast(message, type = '') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show' + (type ? ' ' + type : '');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }
  </script>
</body>
</html>
